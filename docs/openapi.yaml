openapi: 3.0.3
info:
  title: Event AI Server API
  description: |
    A comprehensive REST API for the Event AI platform that handles event management, 
    AI-powered crowd simulation, and real-time notifications.
    
    ## Architecture
    - **Server**: Express.js on AWS EC2
    - **Database**: Supabase PostgreSQL  
    - **Storage**: AWS S3
    - **AI**: Amazon SageMaker
    - **Notifications**: n8n + WhatsApp Business API
    
    ## Authentication
    Currently using API key authentication. Future versions will include JWT.
    
    ## Rate Limiting
    - DISABLED - No rate limiting applied for development
    
    ## Response Format
    All responses follow a consistent format:
    ```json
    {
      "success": true|false,
      "data": {...},
      "message": "Optional message",
      "error": "Error details if success=false"
    }
    ```
  version: 1.0.0
  contact:
    name: Event AI Team
    email: support@eventai.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000
    description: Local development server
  - url: https://your-domain.com
    description: Production server
  - url: https://staging.your-domain.com
    description: Staging server

paths:
  /:
    get:
      summary: Root endpoint
      description: Returns basic server information
      tags:
        - System
      responses:
        '200':
          description: Server information
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Event AI Server"
                  version:
                    type: string
                    example: "1.0.0"
                  environment:
                    type: string
                    example: "development"
                  timestamp:
                    type: string
                    format: date-time

  /health:
    get:
      summary: Health check endpoint
      description: Returns server health status and metrics
      tags:
        - System
      responses:
        '200':
          description: Server health information
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                    example: "1.0.0"
                  environment:
                    type: string
                    example: "development"
                  uptime:
                    type: number
                    description: Server uptime in seconds
                    example: 3600
                  memoryUsage:
                    type: object
                    properties:
                      rss:
                        type: number
                        description: Resident Set Size
                      heapTotal:
                        type: number
                        description: Total heap size
                      heapUsed:
                        type: number
                        description: Used heap size
                      external:
                        type: number
                        description: External memory usage

  /api/v1/users:
    post:
      summary: Create a new user
      description: Creates a new user account with validation
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: User email address
                  example: "john.doe@example.com"
                username:
                  type: string
                  minLength: 3
                  maxLength: 255
                  description: Username (defaults to email if not provided)
                  example: "john.doe@example.com"
                status:
                  type: string
                  enum: [ACTIVE, INACTIVE, SUSPENDED, PENDING]
                  description: User status
                  example: "ACTIVE"
                phone:
                  type: string
                  pattern: '^\+?[1-9]\d{1,14}$'
                  description: Phone number in international format (optional)
                  example: "+1234567890"
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
                  message:
                    type: string
                    example: "User created successfully"
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Conflict - Email or username already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                success: false
                error:
                  status: "fail"
                  message: "Email already exists"
                  code: "DUPLICATE_RESOURCE"
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      summary: Get all users
      description: Retrieves a paginated list of users with optional filtering
      tags:
        - Users
      parameters:
        - name: page
          in: query
          description: Page number (1-based)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of users per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: status
          in: query
          description: Filter by user status
          schema:
            type: string
            enum: [ACTIVE, INACTIVE, SUSPENDED, PENDING]
        - name: search
          in: query
          description: Search in email and username
          schema:
            type: string
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      users:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/users/{userId}:
    get:
      summary: Get user by ID
      description: Retrieves a specific user by their ID
      tags:
        - Users
      parameters:
        - name: userId
          in: path
          required: true
          description: User ID
          schema:
            type: string
            pattern: '^usr_[a-zA-Z0-9-]+$'
            example: "usr_123456789"
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Update user
      description: Updates an existing user
      tags:
        - Users
      parameters:
        - name: userId
          in: path
          required: true
          description: User ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                username:
                  type: string
                  minLength: 3
                  maxLength: 255
                status:
                  type: string
                  enum: [ACTIVE, INACTIVE, SUSPENDED, PENDING]
                phone:
                  type: string
                  pattern: '^\+?[1-9]\d{1,14}$'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
                  message:
                    type: string
                    example: "User updated successfully"
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Conflict - Email or username already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Delete user
      description: Deletes a user account
      tags:
        - Users
      parameters:
        - name: userId
          in: path
          required: true
          description: User ID
          schema:
            type: string
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "User deleted successfully"
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'


  /api/v1/users/statistics:
    get:
      summary: Get user statistics
      description: Retrieves statistical overview of users
      tags:
        - Users
      responses:
        '200':
          description: User statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/UserStatistics'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/users/email/{email}:
    get:
      summary: Get user by email
      description: Retrieves a user by their email address
      tags:
        - Users
      parameters:
        - name: email
          in: path
          required: true
          description: User email
          schema:
            type: string
            format: email
            example: "john.doe@example.com"
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/users/username/{username}:
    get:
      summary: Get user by username
      description: Retrieves a user by their username
      tags:
        - Users
      parameters:
        - name: username
          in: path
          required: true
          description: Username
          schema:
            type: string
            pattern: '^[A-Za-z0-9_-]{3,30}$'
            example: "john_doe"
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/events:
    post:
      summary: Create a new event
      description: Creates a new event with optional file uploads for ticketing data and seating charts
      tags:
        - Events
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - name
                - venue
                - expectedAttendees
                - eventDate
                - eventType
              properties:
                name:
                  type: string
                  description: Event name
                  example: "Summer Music Festival 2024"
                description:
                  type: string
                  description: Event description
                  example: "Annual outdoor music festival featuring top artists"
                venue:
                  type: string
                  description: Event venue
                  example: "Central Park"
                expectedAttendees:
                  type: integer
                  minimum: 1
                  description: Expected number of attendees
                  example: 5000
                eventDate:
                  type: string
                  format: date-time
                  description: Event date and time
                  example: "2024-07-15T18:00:00Z"
                eventType:
                  type: string
                  enum: [CONCERT, CONFERENCE, SPORTS, FESTIVAL, OTHER]
                  description: Type of event
                  example: "FESTIVAL"
                ticketingData:
                  type: string
                  format: binary
                  description: CSV file with ticketing data
                seatingChart:
                  type: string
                  format: binary
                  description: JSON file with seating chart data
      responses:
        '201':
          description: Event created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      eventId:
                        type: string
                        example: "evt_123456789"
                      simulationId:
                        type: string
                        example: "sim_123456789"
                  message:
                    type: string
                    example: "Event created successfully"
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

    get:
      summary: Get all events
      description: Retrieves a paginated list of events
      tags:
        - Events
      parameters:
        - name: page
          in: query
          description: Page number (1-based)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of events per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: status
          in: query
          description: Filter by event status
          schema:
            type: string
            enum: [CREATED, ACTIVE, COMPLETED, CANCELLED]
      responses:
        '200':
          description: List of events
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      events:
                        type: array
                        items:
                          $ref: '#/components/schemas/Event'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/events/{eventId}:
    get:
      summary: Get event by ID
      description: Retrieves a specific event by its ID
      tags:
        - Events
      parameters:
        - name: eventId
          in: path
          required: true
          description: Event ID
          schema:
            type: string
            pattern: '^evt_[a-zA-Z0-9]+$'
            example: "evt_123456789"
      responses:
        '200':
          description: Event details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Event'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    put:
      summary: Update event
      description: |
        Updates an existing event with support for attachment URLs and context for AI chatbot knowledge base.
        All fields are optional - only provided fields will be updated.
      tags:
        - Events
      parameters:
        - name: eventId
          in: path
          required: true
          description: Event ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Event name
                  maxLength: 255
                  example: "Updated Concert in the Park"
                description:
                  type: string
                  description: Event description
                  maxLength: 1000
                  example: "An updated description of the concert event"
                venue:
                  type: string
                  description: Event venue
                  maxLength: 255
                  example: "Central Park Amphitheater"
                dateOfEventStart:
                  type: string
                  format: date-time
                  description: Event start date and time
                  example: "2024-07-15T18:00:00Z"
                dateOfEventEnd:
                  type: string
                  format: date-time
                  description: Event end date and time
                  example: "2024-07-15T23:00:00Z"
                status:
                  type: string
                  enum: [CREATED, ACTIVE, COMPLETED, CANCELLED]
                  description: Event status
                  example: "ACTIVE"
                venueLayout:
                  type: object
                  description: Venue layout configuration (JSON object)
                  example: {"sections": ["A", "B", "C"], "capacity": 5000}
                userEmail:
                  type: string
                  format: email
                  description: Email of the user who created the event
                  example: "user@example.com"
                attachmentUrls:
                  type: array
                  description: Array of attachment URLs for AI chatbot knowledge base
                  items:
                    type: string
                    format: uri
                    maxLength: 2048
                  example: ["https://example.com/event-plan.pdf", "https://example.com/venue-map.jpg"]
                attachmentContext:
                  type: string
                  description: Text interpretation/context of attachments for AI chatbot knowledge base
                  maxLength: 10000
                  example: "Event plan includes detailed schedule and safety protocols. Venue map shows emergency exits and first aid stations."
      responses:
        '200':
          description: Event updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Event'
                  message:
                    type: string
                    example: "Event updated successfully"
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Delete event
      description: Deletes an event and its associated simulation
      tags:
        - Events
      parameters:
        - name: eventId
          in: path
          required: true
          description: Event ID
          schema:
            type: string
      responses:
        '200':
          description: Event deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Event deleted successfully"
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/simulations/{simulationId}/trigger:
    post:
      summary: Trigger AI simulation
      description: Starts an AI simulation for crowd flow analysis
      tags:
        - Simulations
      parameters:
        - name: simulationId
          in: path
          required: true
          description: Simulation ID
          schema:
            type: string
            pattern: '^sim_[a-zA-Z0-9]+$'
            example: "sim_123456789"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                parameters:
                  type: object
                  description: Simulation parameters
                  properties:
                    crowdDensityThreshold:
                      type: number
                      minimum: 0
                      maximum: 1
                      description: Crowd density threshold (0-1)
                      example: 0.7
                    simulationDuration:
                      type: integer
                      minimum: 60
                      description: Simulation duration in seconds
                      example: 3600
                    weatherConditions:
                      type: string
                      enum: [sunny, rainy, cloudy, windy]
                      description: Weather conditions for simulation
                      example: "sunny"
                    emergencyScenario:
                      type: boolean
                      description: Include emergency scenario
                      example: false
      responses:
        '200':
          description: Simulation triggered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      simulationId:
                        type: string
                        example: "sim_123456789"
                      status:
                        type: string
                        example: "RUNNING"
                      startedAt:
                        type: string
                        format: date-time
                  message:
                    type: string
                    example: "Simulation started successfully"
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/simulations/{simulationId}/status:
    get:
      summary: Get simulation status
      description: Retrieves the current status of a simulation
      tags:
        - Simulations
      parameters:
        - name: simulationId
          in: path
          required: true
          description: Simulation ID
          schema:
            type: string
      responses:
        '200':
          description: Simulation status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Simulation'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/simulations/{simulationId}/results:
    get:
      summary: Get simulation results
      description: Retrieves the results of a completed simulation
      tags:
        - Simulations
      parameters:
        - name: simulationId
          in: path
          required: true
          description: Simulation ID
          schema:
            type: string
      responses:
        '200':
          description: Simulation results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      simulationId:
                        type: string
                        example: "sim_123456789"
                      status:
                        type: string
                        example: "COMPLETED"
                      results:
                        $ref: '#/components/schemas/SimulationResults'
                      completedAt:
                        type: string
                        format: date-time
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          description: Simulation not completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Simulation is not completed yet"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/simulations:
    get:
      summary: Get all simulations
      description: Retrieves a paginated list of simulations
      tags:
        - Simulations
      parameters:
        - name: page
          in: query
          description: Page number (1-based)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of simulations per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: status
          in: query
          description: Filter by simulation status
          schema:
            type: string
            enum: [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED]
        - name: eventId
          in: query
          description: Filter by event ID
          schema:
            type: string
      responses:
        '200':
          description: List of simulations
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      simulations:
                        type: array
                        items:
                          $ref: '#/components/schemas/Simulation'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/forecast:
    post:
      summary: Generate crowd forecast
      description: |
        Generates crowd forecast using the new AI model endpoint.
        This endpoint calls the model at http://43.216.25.126/forecast_inout
        and saves the forecast result to the event's forecast_result field.
      tags:
        - Forecast
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - eventid
                - gates
                - schedule_start_time
                - event_end_time
                - method_exits
                - freq
                - gates_crowd
              properties:
                eventid:
                  type: string
                  description: Event ID for which to generate the forecast
                  example: "evt_123456789"
                gates:
                  type: array
                  items:
                    type: string
                  minItems: 1
                  description: Array of gate identifiers
                  example: ["1", "2", "A"]
                schedule_start_time:
                  type: string
                  format: date-time
                  description: Schedule start time in ISO 8601 format
                  example: "2025-09-21T14:00:00"
                event_end_time:
                  type: string
                  format: date-time
                  description: Event end time in ISO 8601 format
                  example: "2025-09-21T16:00:00"
                method_exits:
                  type: string
                  description: Method for handling exits (as string)
                  example: "mirror_delay"
        freq:
          type: string
          description: Frequency for forecast intervals
          example: "5min"
        gates_crowd:
          type: array
          description: Required array of gate capacities corresponding to gates array
          items:
            type: integer
            minimum: 0
          example: [500, 300, 800]
      examples:
              standard_forecast:
                summary: Standard forecast request
                value:
                  eventid: "evt_123456789"
                  gates: ["1", "2", "A"]
                  schedule_start_time: "2025-09-21T14:00:00"
                  event_end_time: "2025-09-21T16:00:00"
                  method_exits: "mirror_delay"
                  freq: "5min"
      responses:
        '200':
          description: Forecast generated successfully. The AI model provides arrivals data (entry rush period) and exits data (departure rush period). Gaps between these periods represent stable event attendance with no rush activity.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/ForecastResult'
                  message:
                    type: string
                    example: "Forecast generated successfully"
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                success: false
                error:
                  status: "fail"
                  message: "Event not found"
                  code: "EVENT_NOT_FOUND"
        '503':
          description: AI model service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                success: false
                error:
                  status: "error"
                  message: "AI model service unavailable"
                  code: "SERVICE_UNAVAILABLE"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/forecast/legacy:
    post:
      summary: Generate forecast (Legacy endpoint)
      description: Legacy forecast endpoint that uses the original AI model structure
      tags:
        - Forecast
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - eventId
              properties:
                eventId:
                  type: string
                  description: Event ID
                  example: "evt_123456789"
                inputData:
                  type: object
                  description: Additional input data for forecasting
                  properties:
                    historicalData:
                      type: object
                      description: Historical data for the event
                    weatherData:
                      type: object
                      description: Weather data for forecast
                    promotionalData:
                      type: object
                      description: Promotional campaign data
                    expectedAttendance:
                      type: integer
                      minimum: 1
                      description: Expected attendance
                    ticketsSold:
                      type: integer
                      minimum: 0
                      description: Number of tickets sold
      responses:
        '200':
          description: Forecast generated successfully. The AI model provides arrivals data (entry rush period) and exits data (departure rush period). Gaps between these periods represent stable event attendance with no rush activity.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/LegacyForecastResult'
                  message:
                    type: string
                    example: "Forecast generated successfully"
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: AI model service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/forecast/{eventId}:
    get:
      summary: Get existing forecast
      description: Retrieves existing forecast for an event
      tags:
        - Forecast
      parameters:
        - name: eventId
          in: path
          required: true
          description: Event ID
          schema:
            type: string
            example: "evt_123456789"
      responses:
        '200':
          description: Forecast retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      eventId:
                        type: string
                        example: "evt_123456789"
                      forecastResult:
                        type: object
                        description: The stored forecast result
                      lastUpdated:
                        type: string
                        format: date-time
                        description: When the forecast was last updated
        '404':
          description: Forecast not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                success: false
                error:
                  status: "fail"
                  message: "Forecast not found for this event"
                  code: "FORECAST_NOT_FOUND"
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Delete forecast
      description: Deletes forecast for an event
      tags:
        - Forecast
      parameters:
        - name: eventId
          in: path
          required: true
          description: Event ID
          schema:
            type: string
            example: "evt_123456789"
      responses:
        '200':
          description: Forecast deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Forecast deleted successfully"
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/forecast/regenerate/{eventId}:
    post:
      summary: Regenerate forecast
      description: Regenerates forecast for an event (convenience endpoint)
      tags:
        - Forecast
      parameters:
        - name: eventId
          in: path
          required: true
          description: Event ID
          schema:
            type: string
            example: "evt_123456789"
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              description: Optional input data for regenerating forecast
      responses:
        '200':
          description: Forecast regenerated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/LegacyForecastResult'
                  message:
                    type: string
                    example: "Forecast regenerated successfully"
        '404':
          description: Event not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: AI model service unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/forecast/health/model:
    get:
      summary: Check legacy AI model health
      description: Checks the health status of the legacy AI model service
      tags:
        - Forecast
      responses:
        '200':
          description: Model health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      modelEndpoint:
                        type: string
                        example: "http://localhost:8080/predict"
                      isHealthy:
                        type: boolean
                        example: true
                      checkedAt:
                        type: string
                        format: date-time
                      type:
                        type: string
                        example: "legacy"
                  message:
                    type: string
                    example: "Legacy AI model service is healthy"
        '503':
          description: Model service unavailable
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "error"
                      message:
                        type: string
                        example: "Unable to check legacy AI model service health"
                      code:
                        type: string
                        example: "SERVICE_UNAVAILABLE"

  /api/v1/forecast/health/new-model:
    get:
      summary: Check new AI model health
      description: Checks the health status of the new AI model service at http://43.216.25.126/forecast_inout
      tags:
        - Forecast
      responses:
        '200':
          description: Model health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      modelEndpoint:
                        type: string
                        example: "http://43.216.25.126/forecast_inout"
                      isHealthy:
                        type: boolean
                        example: true
                      checkedAt:
                        type: string
                        format: date-time
                      type:
                        type: string
                        example: "new"
                  message:
                    type: string
                    example: "New AI model service is healthy"
        '503':
          description: Model service unavailable
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: object
                    properties:
                      status:
                        type: string
                        example: "error"
                      message:
                        type: string
                        example: "Unable to check new AI model service health"
                      code:
                        type: string
                        example: "SERVICE_UNAVAILABLE"

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          description: Internal database ID
          example: 1
        userId:
          type: string
          description: External user ID
          example: "usr_123456789"
        email:
          type: string
          format: email
          description: User email address
          example: "john.doe@example.com"
        username:
          type: string
          description: Username (defaults to email)
          example: "john.doe@example.com"
        status:
          type: string
          enum: [ACTIVE, INACTIVE, SUSPENDED, PENDING]
          description: User status
          example: "ACTIVE"
        phone:
          type: string
          description: Phone number (optional)
          example: "+1234567890"
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2024-01-01T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2024-01-01T12:00:00Z"

    UserStatistics:
      type: object
      properties:
        totalUsers:
          type: integer
          description: Total number of users
          example: 150
        activeUsers:
          type: integer
          description: Number of active users
          example: 120
        inactiveUsers:
          type: integer
          description: Number of inactive users
          example: 20
        suspendedUsers:
          type: integer
          description: Number of suspended users
          example: 10
        pendingUsers:
          type: integer
          description: Number of pending users
          example: 5
        usersWithPhone:
          type: integer
          description: Number of users with phone numbers
          example: 75

    Event:
      type: object
      properties:
        id:
          type: integer
          description: Internal database ID
        eventId:
          type: string
          description: External event ID
          example: "evt_123456789"
        simulationId:
          type: string
          description: Associated simulation ID
          example: "sim_123456789"
        name:
          type: string
          description: Event name
          example: "Summer Music Festival 2024"
        description:
          type: string
          description: Event description
          example: "Annual outdoor music festival"
        venue:
          type: string
          description: Event venue
          example: "Central Park"
        expectedAttendees:
          type: integer
          description: Expected number of attendees
          example: 5000
        eventDate:
          type: string
          format: date-time
          description: Event date and time
        eventType:
          type: string
          enum: [CONCERT, CONFERENCE, SPORTS, FESTIVAL, OTHER]
          description: Type of event
        s3Keys:
          type: object
          description: S3 file keys for uploaded data
          properties:
            ticketingData:
              type: string
              example: "events/evt_123456789/ticketing-data.csv"
            seatingChart:
              type: string
              example: "events/evt_123456789/seating-chart.json"
        status:
          type: string
          enum: [CREATED, ACTIVE, COMPLETED, CANCELLED]
          description: Event status
        attachmentUrls:
          type: array
          description: Array of attachment URLs for AI chatbot knowledge base
          items:
            type: string
            format: uri
          example: ["https://example.com/event-plan.pdf", "https://example.com/venue-map.jpg"]
        attachmentContext:
          type: string
          description: Text interpretation/context of attachments for AI chatbot knowledge base
          example: "Event plan includes detailed schedule and safety protocols. Venue map shows emergency exits and first aid stations."
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
        simulation:
          $ref: '#/components/schemas/Simulation'

    Simulation:
      type: object
      properties:
        id:
          type: integer
          description: Internal database ID
        simulationId:
          type: string
          description: External simulation ID
          example: "sim_123456789"
        eventId:
          type: string
          description: Associated event ID
          example: "evt_123456789"
        status:
          type: string
          enum: [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED]
          description: Simulation status
        parameters:
          type: object
          description: Simulation parameters
          properties:
            crowdDensityThreshold:
              type: number
              example: 0.7
            simulationDuration:
              type: integer
              example: 3600
            weatherConditions:
              type: string
              example: "sunny"
        progress:
          type: object
          description: Simulation progress information
          properties:
            percentage:
              type: number
              minimum: 0
              maximum: 100
              example: 75
            currentStep:
              type: string
              example: "Analyzing crowd patterns"
            estimatedTimeRemaining:
              type: integer
              description: Estimated time remaining in seconds
              example: 300
        results:
          $ref: '#/components/schemas/SimulationResults'
        error:
          type: string
          description: Error message if simulation failed
        startedAt:
          type: string
          format: date-time
          description: Simulation start time
        completedAt:
          type: string
          format: date-time
          description: Simulation completion time
        failedAt:
          type: string
          format: date-time
          description: Simulation failure time
        cancelledAt:
          type: string
          format: date-time
          description: Simulation cancellation time
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp
        event:
          type: object
          description: Associated event information
          properties:
            eventId:
              type: string
            name:
              type: string
            venue:
              type: string
            eventDate:
              type: string
              format: date-time
            eventType:
              type: string

    SimulationResults:
      type: object
      properties:
        summary:
          type: object
          properties:
            totalAttendees:
              type: integer
              example: 4850
            peakCrowdDensity:
              type: number
              example: 0.85
            averageWaitTime:
              type: number
              example: 12.5
            bottleneckAreas:
              type: array
              items:
                type: string
              example: ["Main Entrance", "Food Court"]
        recommendations:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                example: "rec_001"
              type:
                type: string
                example: "CROWD_CONTROL"
              priority:
                type: string
                enum: [HIGH, MEDIUM, LOW]
                example: "HIGH"
              title:
                type: string
                example: "Deploy Additional Staff at Main Entrance"
              description:
                type: string
                example: "High congestion detected at main entrance"
              estimatedImpact:
                type: string
                example: "Reduce wait time by 60%"
              implementationTime:
                type: string
                example: "10 minutes"
        crowdFlowAnalysis:
          type: object
          properties:
            peakHours:
              type: array
              items:
                type: string
              example: ["18:00-19:00", "20:00-21:00"]
            congestionHotspots:
              type: array
              items:
                type: object
                properties:
                  area:
                    type: string
                  severity:
                    type: string
                  timeFrame:
                    type: string
        riskAssessment:
          type: object
          properties:
            overallRisk:
              type: string
              enum: [LOW, MEDIUM, HIGH, CRITICAL]
              example: "MEDIUM"
            specificRisks:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  probability:
                    type: number
                  impact:
                    type: string

    Pagination:
      type: object
      properties:
        currentPage:
          type: integer
          example: 1
        totalPages:
          type: integer
          example: 10
        totalItems:
          type: integer
          example: 95
        itemsPerPage:
          type: integer
          example: 10
        hasNextPage:
          type: boolean
          example: true
        hasPreviousPage:
          type: boolean
          example: false

    ForecastResult:
      type: object
      description: Result from the new AI model forecast endpoint
      properties:
        eventId:
          type: string
          description: Event ID for which the forecast was generated
          example: "evt_123456789"
        forecastResult:
          type: object
          description: The structured forecast data from the AI model
          properties:
            forecast:
              type: array
              description: Array of gate forecast objects
              items:
                type: object
                properties:
                  gate:
                    type: string
                    description: Gate identifier
                    example: "1"
                  timeFrames:
                    type: array
                    description: Time-based forecast predictions for this gate
                    items:
                      type: object
                      properties:
                        timestamp:
                          type: string
                          description: ISO 8601 timestamp for this prediction
                          example: "2025-09-21 14:00:00"
                        predicted:
                          type: integer
                          description: Predicted count (rounded)
                          example: 186
                        lower_bound:
                          type: integer
                          description: Lower bound of prediction (rounded)
                          example: 146
                        upper_bound:
                          type: integer
                          description: Upper bound of prediction (rounded)
                          example: 230
                        dataSource:
                          type: string
                          description: Source of this timeframe data (arrivals = entry rush period, exits = departure rush period, simulation = gap filled with predicted value of 10)
                          enum: ["arrivals", "exits", "simulation"]
                          example: "arrivals"
            metadata:
              type: object
              properties:
                processedAt:
                  type: string
                  format: date-time
                  description: When the response was processed
                modelVersion:
                  type: string
                  description: Version of the AI model used
                  example: "forecast_inout_v1"
                endpoint:
                  type: string
                  description: The AI model endpoint used
                  example: "http://43.216.25.126/forecast_inout"
                totalGates:
                  type: integer
                  description: Total number of gates in forecast
                  example: 3
                timeFrameCount:
                  type: integer
                  description: Number of time frames per gate
                  example: 31
            summary:
              type: object
              properties:
                totalGates:
                  type: integer
                  example: 3
                gates:
                  type: array
                  items:
                    type: string
                  example: ["1", "2", "A"]
                forecastPeriod:
                  type: object
                  properties:
                    start:
                      type: string
                      example: "2025-09-21 11:30:00"
                    end:
                      type: string
                      example: "2025-09-21 15:00:00"
                predictions:
                  type: array
                  items:
                    type: object
                    properties:
                      gate:
                        type: string
                        example: "1"
                      totalTimeFrames:
                        type: integer
                        example: 31
                      peakPrediction:
                        type: integer
                        example: 196
                      avgPrediction:
                        type: integer
                        example: 112
                      dataSources:
                        type: object
                        description: Count of timeframes by data source
                        properties:
                          arrivals:
                            type: integer
                            description: Number of timeframes from arrivals data (entry rush period)
                            example: 13
                          exits:
                            type: integer
                            description: Number of timeframes from exits data (departure rush period)
                            example: 1
                          simulation:
                            type: integer
                            description: Number of timeframes filled with simulation data (predicted value of 10)
                            example: 47
                status:
                  type: string
                  example: "completed"
        generatedAt:
          type: string
          format: date-time
          description: When the forecast was generated
        modelEndpoint:
          type: string
          description: The AI model endpoint that was called
          example: "http://43.216.25.126/forecast_inout"
        inputData:
          type: object
          description: The input data that was sent to the model
          properties:
            gates:
              type: array
              items:
                type: string
              example: ["1", "2", "A"]
            schedule_start_time:
              type: string
              example: "2025-09-21T14:00:00"
            event_end_time:
              type: string
              example: "2025-09-21T16:00:00"
            method_exits:
              type: string
              example: "mirror_delay"
            freq:
              type: string
              example: "5min"

    LegacyForecastResult:
      type: object
      description: Result from the legacy AI model forecast endpoint
      properties:
        eventId:
          type: string
          description: Event ID for which the forecast was generated
          example: "evt_123456789"
        forecastResult:
          type: object
          description: The forecast data from the legacy AI model
          properties:
            prediction:
              type: object
              description: Raw prediction data from the legacy model
            metadata:
              type: object
              properties:
                processedAt:
                  type: string
                  format: date-time
                modelVersion:
                  type: string
                  example: "unknown"
                confidence:
                  type: number
                  description: Confidence score of the prediction
                  example: 0.85
            summary:
              type: object
              properties:
                totalAttendance:
                  type: integer
                  example: 5000
                peakHours:
                  type: array
                  items:
                    type: string
                  example: ["18:00", "19:00"]
                congestionRisk:
                  type: string
                  example: "medium"
                highRiskZones:
                  type: array
                  items:
                    type: string
                  example: ["Main Entrance", "Food Court"]
                recommendations:
                  type: array
                  items:
                    type: string
                  example: ["Deploy additional staff at main entrance"]
                confidence:
                  type: number
                  example: 0.85
        generatedAt:
          type: string
          format: date-time
          description: When the forecast was generated
        modelEndpoint:
          type: string
          description: The AI model endpoint that was called
          example: "http://localhost:8080/predict"
        inputData:
          type: object
          description: The input data that was sent to the model

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
        details:
          type: object
          description: Additional error details

  responses:
    BadRequest:
      description: Bad request - validation errors
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error: "Validation failed"
            code: "VALIDATION_ERROR"
            details:
              - field: "expectedAttendees"
                message: "Expected attendees must be a positive number"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error: "Event not found"
            code: "NOT_FOUND"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error: "Internal server error"
            code: "INTERNAL_ERROR"

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

security:
  - ApiKeyAuth: []

tags:
  - name: System
    description: System health and information endpoints
  - name: Users
    description: User account management operations
  - name: Events
    description: Event management operations
  - name: Simulations
    description: AI simulation operations
  - name: Forecast
    description: AI-powered crowd forecasting operations
